<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comprehensive Patient Health Record</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c6e9b;
      --primary-light: #e8f2f9;
      --secondary: #4CAF50;
      --danger: #e74c3c;
      --warning: #f39c12;
      --success: #27ae60;
      --gray: #95a5a6;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --border-radius: 8px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary) 0%, #1a4e75 100%);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }
    
    .subtitle {
      font-size: 16px;
      opacity: 0.9;
    }
    
    .emergency-badge {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: var(--danger);
      color: white;
      padding: 8px 15px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .content {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 0;
    }
    
    .sidebar {
      background-color: var(--primary-light);
      padding: 25px 20px;
      border-right: 1px solid #dbe9f3;
    }
    
    .main-content {
      padding: 25px;
    }
    
    .profile {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 25px;
    }
    
    .profile-img-container {
      position: relative;
      margin-bottom: 15px;
    }
    
    .profile-img {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid white;
      box-shadow: var(--box-shadow);
    }
    
    .change-photo-btn {
      position: absolute;
      bottom: 5px;
      right: 5px;
      background-color: var(--primary);
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid white;
      transition: all 0.2s;
    }
    
    .change-photo-btn:hover {
      background-color: #235a7c;
    }
    
    .patient-info {
      text-align: center;
    }
    
    .patient-name {
      font-size: 22px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 5px;
    }
    
    .patient-details {
      color: var(--gray);
      margin-bottom: 15px;
    }
    
    .info-card {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 18px;
      margin-bottom: 20px;
      box-shadow: var(--box-shadow);
    }
    
    .info-card h3 {
      color: var(--primary);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-item {
      margin-bottom: 12px;
      display: flex;
      align-items: flex-start;
    }
    
    .info-item:last-child {
      margin-bottom: 0;
    }
    
    .info-label {
      font-weight: 600;
      min-width: 150px;
      color: var(--dark);
    }
    
    .info-value {
      flex: 1;
    }
    
    input[type="text"], select, input[type="date"], input[type="tel"], input[type="email"], textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: inherit;
      font-size: 15px;
      transition: border 0.3s;
    }
    
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    input[type="text"]:focus, select:focus, input[type="date"]:focus, 
    input[type="tel"]:focus, input[type="email"]:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(44, 110, 155, 0.2);
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s;
      width: 100%;
      margin-top: 10px;
    }
    
    .btn:hover {
      background-color: #235a7c;
    }
    
    .btn-download {
      background-color: var(--success);
    }
    
    .btn-download:hover {
      background-color: #219653;
    }
    
    .timestamp {
      text-align: center;
      color: var(--gray);
      font-size: 14px;
      margin-top: 20px;
    }
    
    .badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 5px;
      margin-bottom: 5px;
    }
    
    .badge-allergy {
      background-color: #ffe8e8;
      color: #e74c3c;
    }
    
    .badge-medication {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    
    .badge-history {
      background-color: #e3f2fd;
      color: #1565c0;
    }
    
    .emergency-contact {
      background-color: #fff4f4;
      border-left: 4px solid var(--danger);
    }
    
    .emergency-contact h3 {
      color: var(--danger);
    }
    
    .emergency-contact .info-item {
      flex-wrap: wrap;
    }
    
    .emergency-contact .info-label {
      min-width: 100px;
    }
    
    .emergency-contact .info-value {
      min-width: 0;
      flex: 1 1 200px;
    }
    
    .critical-alert {
      background-color: #fff4f4;
      border-left: 4px solid var(--danger);
    }
    
    .critical-alert h3 {
      color: var(--danger);
    }
    
    .two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    @media (max-width: 992px) {
      .two-column {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .content {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        border-right: none;
        border-bottom: 1px solid #dbe9f3;
      }
      
      .emergency-badge {
        position: static;
        margin-top: 15px;
        justify-content: center;
      }
      
      .info-item {
        flex-direction: column;
      }
      
      .info-label {
        min-width: 100%;
        margin-bottom: 5px;
      }
      
      .emergency-contact .info-value {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="record">
    <header>
      <h1>Comprehensive Patient Health Record</h1>
      <p class="subtitle">Complete medical information for emergency situations</p>
      <div class="emergency-badge">
        <i class="fas fa-exclamation-circle"></i>
        <span>EMERGENCY INFORMATION</span>
      </div>
    </header>
    
    <div class="content">
      <div class="sidebar">
        <div class="profile">
          <div class="profile-img-container">
            <img src="patient.jpg" alt="Patient Photo" class="profile-img" id="patient-photo">
            <div class="change-photo-btn">
              <i class="fas fa-camera"></i>
              <input type="file" id="photo-upload" accept="image/*" style="display: none;">
            </div>
          </div>
          <div class="patient-info">
            <h2 class="patient-name" id="name">Zayyad Ibrahim Zarma</h2>
            <p class="patient-details">
              <span id="age">34 years</span> â€¢ <span id="gender">Male</span>
            </p>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-tint"></i> Blood Information</h3>
          <div class="info-item">
            <span class="info-label">Blood Type:</span>
            <span class="info-value">
              <select id="blood-type">
                <option value="">Select</option>
                <option>O+</option>
                <option>O-</option>
                <option>A+</option>
                <option>A-</option>
                <option>B+</option>
                <option>B-</option>
                <option>AB+</option>
                <option>AB-</option>
              </select>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Genotype:</span>
            <span class="info-value">
              <select id="genotype">
                <option value="">Select</option>
                <option>AA</option>
                <option>AS</option>
                <option>SS</option>
                <option>AC</option>
                <option>SC</option>
                <option>AB</option>
              </select>
            </span>
          </div>
        </div>
        
        <div class="info-card emergency-contact">
          <h3><i class="fas fa-phone-alt"></i> Emergency Contact</h3>
          <div class="info-item">
            <span class="info-label">Name:</span>
            <span class="info-value">
              <input type="text" id="emergency-name" value="Hauwa Zayyad (Spouse)">
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Relationship:</span>
            <span class="info-value">
              <input type="text" id="emergency-relationship" value="Spouse">
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Phone:</span>
            <span class="info-value">
              <input type="tel" id="emergency-phone" value="+2348036559455">
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Alternate Phone:</span>
            <span class="info-value">
              <input type="tel" id="emergency-phone-alt" placeholder="Alternate phone">
            </span>
          </div>
        </div>
        
        <button class="btn btn-download" onclick="downloadPDF()">
          <i class="fas fa-download"></i> Download as PDF
        </button>
        
        <p class="timestamp" id="timestamp">Report generated on: </p>
      </div>
      
      <div class="main-content">
        <div class="info-card">
          <h3><i class="fas fa-user"></i> Personal & Identification Info</h3>
          <div class="two-column">
            <div class="info-item">
              <span class="info-label">Full Name:</span>
              <span class="info-value">
                <input type="text" id="full-name" value="Zayyad Ibrahim Zarma">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Date of Birth:</span>
              <span class="info-value">
                <input type="date" id="dob" value="1989-05-15">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Age:</span>
              <span class="info-value">
                <input type="text" id="age-display" value="34 years">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Gender:</span>
              <span class="info-value">
                <select id="gender-select">
                  <option>Male</option>
                  <option>Female</option>
                  <option>Other</option>
                  <option>Prefer not to say</option>
                </select>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Nationality:</span>
              <span class="info-value">
                <input type="text" id="nationality" value="Nigerian">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">ID Number:</span>
              <span class="info-value">
                <input type="text" id="id-number" placeholder="National ID/Passport">
              </span>
            </div>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-heartbeat"></i> Vital Medical Parameters</h3>
          <div class="info-item">
            <span class="info-label">Allergies:</span>
            <span class="info-value">
              <textarea id="allergies">Penicillin, Dust, Honey, Shellfish</textarea>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Chronic Conditions:</span>
            <span class="info-value">
              <textarea id="chronic-conditions">Hypertension, Asthma, Migraine</textarea>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Current Medications:</span>
            <span class="info-value">
              <textarea id="medications">Lisinopril 10mg daily, Ventolin inhaler as needed, Paracetamol 500mg for headaches</textarea>
            </span>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-history"></i> Past Medical History</h3>
          <div class="info-item">
            <span class="info-label">Major Surgeries:</span>
            <span class="info-value">
              <textarea id="surgeries">Appendectomy (2015), Tonsillectomy (2001)</textarea>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Past Hospitalizations:</span>
            <span class="info-value">
              <textarea id="hospitalizations">Pneumonia (2018), Asthma exacerbation (2020)</textarea>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Vaccination Status:</span>
            <span class="info-value">
              <textarea id="vaccinations">Fully immunized, COVID-19 (3 doses), Yellow Fever (2019), Tetanus (2022)</textarea>
            </span>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-smoking"></i> Lifestyle & Risk Factors</h3>
          <div class="two-column">
            <div class="info-item">
              <span class="info-label">Smoking Status:</span>
              <span class="info-value">
                <select id="smoking-status">
                  <option>Non-smoker</option>
                  <option>Current smoker</option>
                  <option>Former smoker</option>
                </select>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Alcohol Use:</span>
              <span class="info-value">
                <select id="alcohol-use">
                  <option>Non-drinker</option>
                  <option>Occasional</option>
                  <option>Moderate</option>
                  <option>Heavy</option>
                </select>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Drug Use:</span>
              <span class="info-value">
                <select id="drug-use">
                  <option>None</option>
                  <option>Recreational</option>
                  <option>Prescription</option>
                </select>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Exercise Frequency:</span>
              <span class="info-value">
                <select id="exercise">
                  <option>Sedentary</option>
                  <option>Light (1-2 days/week)</option>
                  <option>Moderate (3-5 days/week)</option>
                  <option>Active (6-7 days/week)</option>
                </select>
              </span>
            </div>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-wheelchair"></i> Functional & Support Needs</h3>
          <div class="info-item">
            <span class="info-label">Disability Status:</span>
            <span class="info-value">
              <textarea id="disability" placeholder="Mobility aids, visual or hearing impairments, etc.">None</textarea>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Special Needs:</span>
            <span class="info-value">
              <textarea id="special-needs" placeholder="Oxygen, dialysis, etc.">None</textarea>
            </span>
          </div>
        </div>
        
        <div class="info-card critical-alert">
          <h3><i class="fas fa-exclamation-triangle"></i> Critical Alerts / Notes</h3>
          <div class="info-item">
            <span class="info-label">Medical Devices:</span>
            <span class="info-value">
              <textarea id="medical-devices" placeholder="Pacemaker, insulin pump, etc.">None</textarea>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Advance Directives:</span>
            <span class="info-value">
              <select id="advance-directives">
                <option>Full resuscitation</option>
                <option>DNR (Do Not Resuscitate)</option>
                <option>DNR/DNI (Do Not Intubate)</option>
                <option>Other</option>
              </select>
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">Religious Restrictions:</span>
            <span class="info-value">
              <textarea id="religious-restrictions" placeholder="Jehovah's Witness, etc.">None</textarea>
            </span>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-dna"></i> Family Medical History</h3>
          <div class="info-item">
            <span class="info-label">Family History:</span>
            <span class="info-value">
              <textarea id="family-history">Mother: Hypertension, Diabetes; Father: Heart disease, Hypertension; Maternal grandmother: Breast cancer</textarea>
            </span>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-clipboard-list"></i> Recent Vital Signs</h3>
          <div class="two-column">
            <div class="info-item">
              <span class="info-label">Blood Pressure:</span>
              <span class="info-value">
                <input type="text" id="blood-pressure" value="120/80 mmHg">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Heart Rate:</span>
              <span class="info-value">
                <input type="text" id="heart-rate" value="72 bpm">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Weight:</span>
              <span class="info-value">
                <input type="text" id="weight" value="82 kg">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Height:</span>
              <span class="info-value">
                <input type="text" id="height" value="178 cm">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">BMI:</span>
              <span class="info-value">
                <input type="text" id="bmi" value="25.9">
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Last Updated:</span>
              <span class="info-value">
                <input type="date" id="vitals-date" value="2023-11-15">
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Function to set timestamp
    function updateTimestamp() {
      const now = new Date();
      const formatted = now.toLocaleString();
      document.getElementById("timestamp").textContent = "Report generated on: " + formatted;
      return now;
    }
    updateTimestamp(); // Show immediately

    // Enable inline editing + save to localStorage
    function setupInputSaving() {
      document.querySelectorAll("input, select, textarea").forEach(el => {
        const id = el.id;
        if (!id) return;
        
        const savedValue = localStorage.getItem(id);
        if (savedValue !== null) {
          if (el.type === 'checkbox') {
            el.checked = savedValue === 'true';
          } else {
            el.value = savedValue;
          }
        }

        el.addEventListener("change", () => {
          if (el.type === 'checkbox') {
            localStorage.setItem(id, el.checked);
          } else {
            localStorage.setItem(id, el.value);
          }
          
          // Update age if DOB changes
          if (id === 'dob') {
            updateAgeFromDOB();
          }
        });
      });
    }

    // Calculate age from date of birth
    function updateAgeFromDOB() {
      const dobInput = document.getElementById('dob');
      const ageDisplay = document.getElementById('age-display');
      
      if (dobInput.value) {
        const birthDate = new Date(dobInput.value);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
          age--;
        }
        
        ageDisplay.value = `${age} years`;
        localStorage.setItem('age-display', ageDisplay.value);
      }
    }

    // Handle photo upload
    const photoInput = document.getElementById("photo-upload");
    const photoImg = document.getElementById("patient-photo");
    const changePhotoBtn = document.querySelector(".change-photo-btn");
    const savedPhoto = localStorage.getItem("patient-photo");
    
    // Load saved photo if available, otherwise use patient.jpg
    if (savedPhoto) {
      photoImg.src = savedPhoto;
    } else {
      // Ensure patient.jpg is loaded
      photoImg.src = "patient.jpg";
    }

    changePhotoBtn.addEventListener("click", function() {
      photoInput.click();
    });

    photoInput.addEventListener("change", function() {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          photoImg.src = e.target.result;
          localStorage.setItem("patient-photo", e.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    // Download PDF with dynamic filename
    function downloadPDF() {
      const now = updateTimestamp(); // Refresh timestamp each time
      const element = document.getElementById("record");

      const patientName = document.getElementById("name").textContent.replace(/\s+/g, "_");
      const dateStr = now.toISOString().split("T")[0]; // yyyy-mm-dd
      const filename = patientName + "_Health_Record_" + dateStr + ".pdf";

      const opt = {
        margin:       0.5,
        filename:     filename,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      
      html2pdf().set(opt).from(element).save();
    }
    
    // Initialize on page load
    document.addEventListener("DOMContentLoaded", function() {
      setupInputSaving();
      updateAgeFromDOB();
      
      // Set up blood type and genotype from saved values
      const savedBloodType = localStorage.getItem('blood-type');
      if (savedBloodType) {
        document.getElementById('blood-type').value = savedBloodType;
      }
      
      const savedGenotype = localStorage.getItem('genotype');
      if (savedGenotype) {
        document.getElementById('genotype').value = savedGenotype;
      }
    });
  </script>
</body>
</html>
